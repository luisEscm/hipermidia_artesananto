<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Compras</title>
    <link rel="stylesheet" href="pgcomp/compra.css"> 
</head>
<body>
    <!--=============================================== Essa pagina é para quando não esta logado ainda mas esta vendo os produtos ===============================================-->
    <!-- ================= Header ================= -->
    <header class="header">
        <div class="header-left">
            <h1 class="logo">Art Attack</h1>
        </div>

        <div class="header-center">
            <input 
                type="text"
                placeholder="Buscar produtos artesanais..."
                class="search-input"
                oninput="atualizarBusca(this.value)"
            />
        </div>

        <div class="header-right">
            <a href="login.html" class="btn-login">
                <img 
                    src="https://cdn-icons-png.flaticon.com/512/1286/1286923.png"
                    alt="Entrar"
                    class="login-icon"
                >
                Entrar
            </a>
        </div>
    </header>

    <!-- ============== aqui é onde vão estar as tags para filtragem ============== -->
    <nav class="tags-filter">
        <ul class="tag-list" id="filterTags">
        </ul>
    </nav>

    <!-- ============== Os produtos vão ficar nessa parte ============== -->
    <main class="main-content">

        <section class="intro">
            <h2>Produtos Artesanais Brasileiros</h2>
            <p>Descubra peças únicas feitas à mão por artesãos de todo o Brasil</p>
        </section>

        <!-- ============== Aqui vai ficar a grid dos produtos ============== -->
        <section class="product-grid" id="Grid_prods">
        </section>
    </main>

    <script>
        // Esse é um exemplo estatico de produtos que vão aparecer na tela
        const prods = [
            {id: 1,
             nome: "Megaman",
             produtor: "Cerâmica da Terra",
             preco: "R$ 189,90",
             estoque: 15,
             imagem: "pgcomp/imagens trabalho/megaman.png",
             tags: ["Heroi", "Video game", "Megaman"],
             descricao: "Uma action figure do megaman inspirada no megaman 4 feito a mão.",
             detalhes: ["100% feito à mão", "Qualidad alta", "Articulado", "3 variações de rosto"]
            },
            {
             id: 2,
             nome: "xavier e magneto",
             produtor: "Couro & Arte",
             preco: "R$ 79,90",
             estoque: 8,
             imagem: "pgcomp/imagens trabalho/dr. xavier, magneto.png",
             tags: ["Plastico", "X-man", "Vilão", "Heroi"],
             descricao: "Uma action figure do professor xavier e do magneto inspirada no filme X-man feitos a mão.",
             detalhes: ["100% feito à mão", "Produção sustentável", "Materiais naturais", "Entrega em todo o Brasil"]
            }
        ];

        let filtrosSelecionados = new Set(); // filtros escolhidos para obter os produtos
        let textoBusca = ""; // texto de busca

        function criarCardProduto(produto) {
            return `
                <article class="product-card">
                    <div class="product-image" onclick="openModal(${produto.id})">
                        <img src="${produto.imagem}" alt="${produto.nome}">
                        <button class="favorite-btn">♡</button>
                    </div>

                    <div class="product-info">
                        <h3>${produto.nome}</h3>
                        <span class="producer">por ${produto.produtor}</span>

                        <div class="tags">
                            ${produto.tags.slice(0, 2).map(tag =>
                                `<span class="tag">${tag}</span>`
                            ).join("")}
                            ${produto.tags.length > 2 ? `<span class="tag">+${produto.tags.length - 2}</span>` : ""}
                        </div>

                        <div class="price-stock">
                            <span class="price">${produto.preco}</span>
                            <span class="stock">${produto.estoque} disponíveis</span>
                        </div>

                        <button class="btn-cart">Adicionar ao Carrinho</button>
                    </div>
                </article>
            `;
        }

        function carregarProdutos() {
            const grid = document.getElementById("Grid_prods");
            grid.innerHTML = "";

            prods.forEach(prod => {
                grid.innerHTML += criarCardProduto(prod);
            });
        }

        function obterTagsUnicas() {
            const todasTags = prods.flatMap(prod => prod.tags);
            return [...new Set(todasTags)];
        }

        function renderizarFiltros() {
            const container = document.getElementById("filterTags");
            const tags = obterTagsUnicas();

            container.innerHTML = "";

            tags.forEach(tag => {
                const li = document.createElement("li");
                li.className = "filter-tag";
                li.textContent = tag;

                li.onclick = () => ligarFiltro(tag, li);

                container.appendChild(li);
            });
        }

        function ligarFiltro(tag, element) {
            if (filtrosSelecionados.has(tag)) {
                filtrosSelecionados.delete(tag);
                element.classList.remove("active");
            } else {
                filtrosSelecionados.add(tag);
                element.classList.add("active");
            }

            filtrarProdutos();
        }

        function filtrarProdutos() {
            const grid = document.getElementById("Grid_prods");
            grid.innerHTML = "";

            const produtosFiltrados = prods.filter(prod => {

                // tags que foram selecionadas
                const passaTags =
                    filtrosSelecionados.size === 0 ||
                    prod.tags.some(tag => filtrosSelecionados.has(tag));

                // texto de busca
                const passaBusca =
                    textoBusca === "" ||
                    prod.nome.toLowerCase().includes(textoBusca);

                return passaTags && passaBusca;
            });

            produtosFiltrados.forEach(prod => {
                grid.innerHTML += criarCardProduto(prod);
            });

            if (produtosFiltrados.length === 0) {
                grid.innerHTML = `
                    <p style="grid-column: 1 / -1; text-align:center;">
                        Nenhum produto encontrado.
                    </p>
                `;
            }
        }

        // atualiza o texto de busca a cada caractere inserido
        function atualizarBusca(valor) {
            textoBusca = valor.toLowerCase().trim();
            filtrarProdutos();
        }

        // Card de detalhes do produto
        function renderizarTagsModal(tags) {
            const container = document.getElementById("modalTags");
            container.innerHTML = "";

            // atualizando as tags do card especifico do produto
            tags.forEach(tag => {
                const span = document.createElement("span");
                span.classList.add("tag");
                span.textContent = tag;

                container.appendChild(span);
            });
        }

        function renderizarDetalhes(detalhes){
            const container = document.getElementById("modalDetalhes");
            container.innerHTML = "";

            // para cada "detalhe" ele vai adicionando na lista
            detalhes.forEach(det => {
                const li = document.createElement("li");
                li.classList.add("detalhes");
                li.textContent = det;

                container.appendChild(li);
            })
        }

        function openModal(id) {
            const produto = prods.find(p => p.id === id);
            console.log(produto)
            if (!produto) return;

            // Inserindo os elementos do produto escolhido
            document.getElementById("modalImage").src = produto.imagem;
            document.getElementById("modalTitle").innerText = produto.nome;
            document.getElementById("modalvendedor").innerText = produto.produtor;
            document.getElementById("modalPrice").innerText = produto.preco;
            document.getElementById("modalDescription").innerText = produto.descricao;


            document.getElementById("modalEstoque").innerText = produto.estoque

            renderizarTagsModal(produto.tags)
            renderizarDetalhes(produto.detalhes)


            document.getElementById("productModal")
                .classList.add("active");
        }

        function closeModal() {
            document.getElementById("productModal")
                .classList.remove("active");
        }
    
        function atualizarPagina(pag){
            window.location.href = pag;
        }

        renderizarFiltros();
        filtrarProdutos();
        carregarProdutos();
    </script>

    <!--========================== O card mais detalhado do produto ==========================-->
    <div class="modal" id="productModal">
        <div class="modal-content">

            <button class="modal-close" onclick="closeModal()">✕</button>

            <div class="modal-body">
                <!-- Imagem -->
                <div class="modal-image">
                    <img id="modalImage" src="">
                </div>

                <!-- Informações -->
                <div class="modal-info">
                    <h2 id="modalTitle"></h2>
                    <p class="modal-vendedor">
                        por <span id="modalvendedor"></span>
                    </p>

                    <!-- Aqui tem umas tags de placeholder-->
                    <div class="tags" id="modalTags">
                        <span>Cerâmica</span>
                        <span>Decoração</span>
                        <span>Cozinha</span>
                    </div>

                    <p class="stock">
                        Disponibilidade: 
                        <strong>
                            <span id="modalEstoque"></span> unidades em estoque
                        </strong>
                    </p>


                    <p class="price" id="modalPrice"></p>

                    <h3>Descrição</h3>
                    <p class="description" id="modalDescription"></p>

                    <h3>Detalhes</h3>
                    <ul id="modalDetalhes">
                    </ul>

                    <!-- os botões de interação, só o botão de compra possui interação-->
                    <div class="modal-actions">
                        <button class="btn-primary" onclick="atualizarPagina('login.html')">
                            <img class="icon-action-prim" src="pgcomp/compra_imgs/cart.png"></img>
                            <sapn>Adicionar ao Carrinho</sapn>
                        </button>

                        <button class="btn-secondary" onclick="atualizarPagina('login.html')">
                            <img class="icon-action" src="pgcomp/compra_imgs/heart.png"></img>
                            <span>Favoritar</span>
                        </button>
                        <button class="btn-secondary">
                            <img class="icon-action" src="pgcomp/compra_imgs/share.png"></img>
                            <span>Compartilhar</span>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</body>
</html>