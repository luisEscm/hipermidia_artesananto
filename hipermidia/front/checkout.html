<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <title>Checkout</title>
    <link rel="stylesheet" href="pgcomp/pagamento.css">
</head>

<body>
<!--================= Essa pagina coleta o endereço CEP e tals =================-->
<header class="top-bar">
    <a href="compra.html">← Voltar ao carrinho</a>
</header>

<main class="container">
    <!--Avanço das etapas-->
    <div class="steps">
        <div class="step active">
            <span class="step-number">1</span>
            <span class="step-text">Informações</span>
        </div>

        <div class="step-line"></div>

        <div class="step">
            <span class="step-number">2</span>
            <span class="step-text">Pagamento</span>
        </div>
    </div>


    <div class="layout">

        <!-- Formulário -->
        <div class="card">
            <h3>Informações de Entrega</h3>

            <form id="checkoutForm" onsubmit="irPagamento(event)">
                <label>Nome Completo</label>
                <input id="nome" required>

                <label>Telefone</label>
                <input id="telefone" required>

                <label>E-mail</label>
                <input id="email" required>

                <label>Endereço</label>
                <input id="endereco" required>

                <div class="row">
                    <div>
                        <label>Cidade</label>
                        <input id="cidade" required>
                    </div>
                    <div>
                        <label>UF</label>
                        <input id="uf" maxlength="2" required style="text-transform: uppercase;">
                    </div>
                </div>

                <label>CEP</label>
                <input id="cep" required>

                <button type="submit" class="btn-primary">
                    Continuar para Pagamento
                </button>
            </form>
        </div>

        <!-- informações do pedido -->
        <div class="card">
            <h3>Resumo do Pedido</h3>

            <div id="items" class="resumo-items"></div>

            <hr>

            <div class="total-line">
                <span>Subtotal</span>
                <span id="subtotal"></span>
            </div>

            <div class="total-line">
                <span>Frete</span>
                <span>R$ 15,00</span>
            </div>

            <div class="total-line total">
                <strong>Total</strong>
                <strong id="total"></strong>
            </div>
        </div>

    </div>
</main>

<script>
    // pegando o carrinho atual
    function obterCarrinho() {
        return JSON.parse(localStorage.getItem("carrinho")) || [];
    }

    // Gera o resumo usando os itens no carrinho
    function carregarResumo() {
        const carrinho = obterCarrinho();
        let subtotal = 0;
        const itemsDiv = document.getElementById("items");

        itemsDiv.innerHTML = "";

        carrinho.forEach(item => {
            const totalItem = item.preco * item.qtd;
            subtotal += totalItem;

            itemsDiv.innerHTML += `
                <div class="resumo-item">
                    <img src="${item.imagem}" alt="${item.nome}">
                    
                    <div class="resumo-item-info">
                        <p><strong>${item.nome}</strong></p>
                        <span>Qtd: ${item.qtd}</span><br>
                        <span>R$ ${totalItem.toFixed(2)}</span>
                    </div>
                </div>
            `;
        });

        document.getElementById("subtotal").innerText = `R$ ${subtotal.toFixed(2)}`;
        document.getElementById("total").innerText = `R$ ${(subtotal + 15).toFixed(2)}`;
    }

    carregarResumo();
    
    // função de envio do formulario
    function irPagamento(event) {
        event.preventDefault();

        const dadosEntrega = {
            nome: document.getElementById("nome").value,
            telefone: document.getElementById("telefone").value,
            email: document.getElementById("email").value,
            endereco: document.getElementById("endereco").value,
            cidade: document.getElementById("cidade").value,
            uf: document.getElementById("uf").value,
            cep: document.getElementById("cep").value
        };

        // salva no localStorage
        localStorage.setItem("entrega", JSON.stringify(dadosEntrega));
        localStorage.setItem("frete", 15);

        // vai para a página de pagamento
        window.location.href = "pagamento.html";
    }

</script>

</body>
</html>
