<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <title>Pagamento</title>
    <link rel="stylesheet" href="pgcomp/pagamento.css">
</head>
<body>
<!--============================= Pagina para o pagamento da compra =============================-->
<header class="top-bar">
    <a href="checkout.html">← Voltar</a>
</header>

<main class="container">
    <!-- progresso do pagamento-->
    <div class="steps">
        <div class="step completed">
            <span class="step-number">✓</span>
            <span class="step-text">Informações</span>
        </div>

        <div class="step-line"></div>

        <div class="step active">
            <span class="step-number">2</span>
            <span class="step-text">Pagamento</span>
        </div>
    </div>

    <div class="layout">

        <!-- Pagamento -->
        <div class="card">
            <h3>Método de Pagamento</h3>

            <div class="payment-options">

                <label class="payment-option">
                    <input type="radio" name="pagamento" value="cartao" checked onchange="trocarPagamento(this.value)">
                    <div class="payment-box">
                        <img src="https://cdn-icons-png.flaticon.com/512/633/633611.png" alt="Cartão">
                        <span>Cartão</span>
                    </div>
                </label>

                <label class="payment-option">
                    <input type="radio" name="pagamento" value="pix" onchange="trocarPagamento(this.value)">
                    <div class="payment-box">
                        <img src="https://cdn-icons-png.flaticon.com/512/5968/5968705.png" alt="PIX">
                        <span>Pix</span>
                    </div>
                </label>

            </div>
            <!-- Cartão -->
            <div id="cartaoCampos">
                <label>Número do Cartão</label>
                <input id="numeroCartao">

                <label>Nome no Cartão</label>
                <input id="nomeCartao">

                <div class="row">
                    <input id="validade" placeholder="MM/AA">
                    <input id="cvv" placeholder="CVV">
                </div>
            </div>

            <!-- Pix -->
            <div id="pixInfo" style="display:none; margin-top:12px;">
                <p>
                    O pagamento via PIX será gerado após confirmar o pedido.
                </p>
            </div>

            <button class="btn-primary" onclick="finalizar()">
                Finalizar Pedido
            </button>
        </div>

        <!-- Valor da compra -->
        <div class="card">
            <h3>Resumo do Pedido</h3>

            <div id="items" class="resumo-items"></div>

            <hr>

            <div class="total-line">
                <span>Subtotal</span>
                <span id="subtotal"></span>
            </div>

            <div class="total-line">
                <span>Frete</span>
                <span>R$ 15,00</span>
            </div>

            <div class="total-line total">
                <strong>Total</strong>
                <strong id="total"></strong>
            </div>
        </div>

    </div>
</main>

<script>
        // pegando o carrinho atual
    function obterCarrinho() {
        return JSON.parse(localStorage.getItem("carrinho")) || [];
    }

    // Gera o resumo usando os itens no carrinho
    function carregarResumo() {
        const carrinho = obterCarrinho();
        let subtotal = 0;
        const itemsDiv = document.getElementById("items");

        itemsDiv.innerHTML = "";

        carrinho.forEach(item => {
            const totalItem = item.preco * item.qtd;
            subtotal += totalItem;

            itemsDiv.innerHTML += `
                <div class="resumo-item">
                    <img src="${item.imagem}" alt="${item.nome}">
                    
                    <div class="resumo-item-info">
                        <p><strong>${item.nome}</strong></p>
                        <span>Qtd: ${item.qtd}</span><br>
                        <span>R$ ${totalItem.toFixed(2)}</span>
                    </div>
                </div>
            `;
        });

        document.getElementById("subtotal").innerText = `R$ ${subtotal.toFixed(2)}`;
        document.getElementById("total").innerText = `R$ ${(subtotal + 15).toFixed(2)}`;
    }

    carregarResumo();

    // Troca cartão/pix
    document.querySelectorAll('input[name="pagamento"]').forEach(radio => {
        radio.addEventListener("change", () => {
            const metodo = radio.value;
            document.getElementById("cartaoCampos").style.display =
                metodo === "cartao" ? "block" : "none";

            document.getElementById("pixInfo").style.display =
                metodo === "pix" ? "block" : "none";
        });
    });

    // função de finalização
    function finalizar() {
        const metodo = document.querySelector('input[name="pagamento"]:checked').value;

        if (metodo === "cartao") {
            const numero = document.getElementById("numeroCartao").value.trim();
            const nome = document.getElementById("nomeCartao").value.trim();
            const validade = document.getElementById("validade").value.trim();
            const cvv = document.getElementById("cvv").value.trim();

            if (!numero || !nome || !validade || !cvv) {
                alert("Preencha todos os dados do cartão.");
                return;
            }
        }

        // simula sucesso
        window.location.href = "pagamento_sucesso.html";
    }

    carregarResumo();
</script>

</body>
</html>
